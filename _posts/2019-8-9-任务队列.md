---
layout: post
title: "Event loop"
subtitle: ""
date: 2018-09-27 12:00:00
author: "左手喝水"
header-img: "img/post-bg-2015.jpg"
tags:
  - js
---

## Event loop


执行栈：将入放入栈中js主线程将依次执行
任务队列：由异步任务组成的队列，队列又分宏任务队列和微任务队列，不同队列放入对应类型的任务
微任务：`Promise process.nextTick MutaionObserver`  
宏任务：`script(整体代码)、setTimeout、setInterval、I/O、UI交互事件、postMessage、MessageChannel、setImmediate(Node.js 环境)` 

任务执行顺序：

1. 所有同步任务压入执行栈，宏微任务分别压入宏微队列
2. 执行栈任务完成后先将微任务队列中的全部任务压入执行栈执行，执行完成以后检查宏任务队列
3. 从宏任务中调入一个任务执行，执行完成以后检查微任务队列（宏任务中可能包含微任务，如果包含执行宏任务的时候会把微任务压入微任务队列）
4. 宏微任务交替执行直到任务队列为空

await await跟着的表达式会先执行一遍，之后的代码会放到微任务里面等待执行
宏任务执行完毕会让浏览器重新渲染，微任务不会

参考：

MDN-事件循环：<https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop>  
掘金-Event loop但规范和实现:<https://juejin.im/post/5a6155126fb9a01cb64edb45>  
掘金-这一次，彻底弄懂 JavaScript 执行机制：<https://juejin.im/post/59e85eebf265da430d571f89>  
前端一百题-异步:<https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/7>

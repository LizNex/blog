---
layout: post
title: 'mysql必知必会'
subtitle: ''
date: 2019-12-04 12:00:00
author: '左手喝水'
header-img: 'img/post-bg-2015.jpg'
tags:
  - mysql
---

## 关键字

- distinct: 去重,不能对部分列使用
- limit: 限制输出行数
- desc: 倒序，只作用在前面声明列
- where: <,>,=,>=,<=,!=,between,is null
- and,or: 配合 where 组成多条件
- in,not: 配合 where 筛选，MySQL 支持使用 NOT 对 IN、BETWEEN 和 EXISTS 子句取反
- like:搜索关键字，搭配 where 形成条件语句
- %: 通配符，与 like 搭配使用，匹配任意字符 0 或多次。不能匹配 null
- \_: 通配符，匹配任意字符 1 次
- regexp: 正则，后面跟正则表达式，和 like 功能有重叠
- BINARY: 区分正则的大小写
- concat():拼接信息
- rtrim,ltrim,trim:去除多余空格
- as: 别名
- group by :分组
- having:分组后筛选
- union: 组合查询

## 练习

### mysql 必知必会

#### 储存过程

```sql
-- 创建
create procedure product_pricing()
  begin
    select avg(prod_price) as priceaverage from products;
  end;

-- 使用
call product_pricing();

-- 删除
drop procedure product_pricing

--- 带参数
create procedure order_total(
  out o_total decimal(8,2),
  in o_number int,
  in texable boolean
)
begin
  declare total decimal(8,2);
  declare texrate int default 6;

  select sum(quantity*item_price)  from orderitems
  where order_num = o_number
  into total;

  if texable then
    select total+(total/100*texrate) into total;
  end if;

  select total into o_total;
end;

call order_total(@total,20005,0);

select @total;
```

#### 游标

```sql
begin
  DECLARE done boolean DEFAULT 0;
  declare o int;
  declare order_cursor cursor
  for
  select order_num from orders;
  open order_cursor;
  fetch order_cursor into o;
  close order_cursor;
  select o;
end
```

### 50 题 sql 练习

1

```sql
select * from (
  select t1.sid,class1,class2 from
    (select sid,score as class1 from `SC`where `CId` = '01' ) as t1,
    (select sid,score as class2 from `SC` where `CId` = '02') as t2
    where class1> class2
    and t1.sid = t2.sid
)r
left join `Student`
on Student.SId = r.SId;
```

1.1

```sql
select t1.sid from
  (select sid  from `SC` where cid = "01") as t1,
  (select sid from `SC` where cid = "02") as t2
where t1.SId = t2.SId;
```

1.2

```sql
select * from
  (select * from `SC` where `CId` = "01") as t1
  left join
  (select * from `SC` where `CId` = "02") as t2
  on t1.sid = t2.sid;
```

1.3

```sql
select * from `SC`
  where sid not in (
    select `SId` from `SC` where `CId` = "01"
  )
  and `CId` = '02';
```

2

```sql
select `Student`.sid,sname,avg_score from `Student`
  ,(
    select sid,avg(score) as avg_score from `SC`
    group by sid
    having avg_score >60
  ) as r
  where `Student`.`SId` = r.sid;
```

3

```sql
select distinct student.* from `Student`,`SC`
  where `Student`.`SId` = `SC`.`SId`;
```

4

```sql
select `Student`.sid,sname,c_count,s_total from
  `Student`,
  (select sid, count(cid) as c_count,sum(score) as s_total from `SC`
  group by sid
  ) as t1
  where `Student`.`SId` = t1.sid;
```

4.1

```sql
select * from `Student`
where `Student`.`SId` in (select sc.sid from `SC`);
```

5

```sql
select count(*) from `Teacher` where `Tname` like '李%';
```

6

```sql
select `Student`.* from `Student`,`Course`,`SC`,`Teacher`
where
`Student`.sid = sc.sid
and `Course`.cid = sc.sid
and `Course`.`TId` = `Teacher`.`TId`
and `Tname` = "张三";
```

7

```sql
select * from student
where student.sid in (
  select sid from `SC`
  group by sid
  having count(sc.cid) < (select count(cid) from `Course`)
);
```

8

```sql
select * from `Student`
  where sid != '01'
  and sid in
    (select sid from `SC` where cid in
      (select cid from `SC` where sid = '01')
    );
```

9

```sql
select * from `Student`,
  (select sid from sc where sid<>'01'
  group by sid
  having group_concat(cid order by cid) = (select group_concat(cid order by cid) from SC where sid = '01')
  ) as t
  where `Student`.`SId` = t.sid
```

10

```sql
 select `Student`.sname from `Student`,`SC`,`Course`,`Teacher`
  where teacher.tid = course.tid
  and sc.cid = course.cid
  and `Student`.`SId` = `SC`.`SId`
  and teacher.tname = '张三' ;
```

50 题 sql 练习：https://www.jianshu.com/p/476b52ee4f1b

## 注意

- 检索的第一行索引是 0
- MySQL 在执行匹配时默认不区分大小写，所以 fuses 与 Fuses 匹配。
- 不要过度使用通配符。如果其他操作符能达到相同的目的，应该 使用其他操作符。
- 在确实需要使用通配符时，除非绝对有必要，否则不要把它们用 在搜索模式的开始处。把通配符置于搜索模式的开始处，搜索起 来是最慢的。
- 一条语句插入多条数据比多条语句插入一条语句速度要快

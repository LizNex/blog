---
layout: post
title: "浏览器缓存"
subtitle: ""
date: 2018-09-27 12:00:00
author: "左手喝水"
header-img: "img/post-bg-2015.jpg"
tags:
  - 浏览器
---

## 浏览器缓存

浏览器的缓存都是通过识别http请求头的标示来缓存数据

![浏览器缓存流程](/blog/img/in-post/浏览器缓存/flow.jpg){:height="70%" width="70%"}

<center style="color:#999"> 浏览器缓存流程 </center>

缓存分为两种

- 强制缓存  
- 协商缓存

## 强制缓存

强制缓存是通过请求头设置的属性把数据缓存在本机上

强制缓存参考的请求头

- Expires(HTTP/1.0)  
  缓存过期的时间，使用时间格式表示。`expires:Mon, 12 Aug 2019 08:58:15 GMT` 当本机时间在这个时间范围内将使用缓存。但由于这个方式是使用本机时间会出现偏差，所以在HTTP/1.1中有了新的方式控制

- Cache-Control(HTTP/1.1)  
  缓存过期的时间，使用时间戳表示。`cache-control: max-age = 600`。缓存内容将在规定的毫秒数后失效。取用相对时间比较准确。

  Cache-Control  

  在HTTP/1.1中，Cache-Control是最重要的规则，主要用于控制网页缓存，主要取值为：

  public：所有内容都将被缓存（客户端和代理服务器都可缓存）

  private：所有内容只有客户端可以缓存，Cache-Control的默认取值

  no-cache：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定

  no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存

  max-age=xxx (xxx is numeric)：缓存内容将在xxx秒后失效

强制缓存流程：

- 有强制缓存：直接读取缓存
- 强制缓存过期：读取缓存标示使用协商缓存
- 无强制缓存：发起HTTP请求

## from memory 与 from disk

强制缓存在有效期中时会从内存或者硬盘中读取缓存，也就是from memory 与 from disk；  

from memory 基本只是储存小数据，并且随着线程的关闭而失效，也就是标签关闭就会失效；

from disk 可以存大的数据，但速度不如内存快；不会随着线程关闭失效；重新打开浏览器后会把一些资源放入 memory 如果标签刷新数据则直接从memory中读取；

## 协商缓存

协商缓存是强制缓存失效以后，和服务器协商通信当前本地缓存是否是最新的数据；如果资源没有更新返回304读取本地缓存。过期则直接返回最新资源。

- Last-Modified / If-Modified-Since（优先级低）
Last-Modified是最后修改时间。协商请求时会在请求头的`If-Modified-Since`放入Last-Modified的信息让服务端判断资源是否过期

- Etag / If-None-Match（优先级高）
Etag是资源唯一标示，在返回请求头中。协商请求时会在请求头的`If-None-Match`放入Etag的信息让服务端判断资源是否更新；

参考：
掘金-彻底理解浏览器的缓存机制：<https://juejin.im/entry/5ad86c16f265da505a77dca4>
---
layout: post
title: 'docker'
subtitle: ''
date: 2020-7-13 12:00:00
author: '左手喝水'
header-img: 'img/post-bg-2015.jpg'
tags:
  - 运维
---

# docker

## docker 的优点

1. 开发和部署通过 docker 统一环境，减少运维和开发之间的沟通难度
2. 与虚拟机相比减少了 os 层，更高效利用资源

## docker file

- RUN: 复杂命令用反斜杠换行避免无用分层，多条命令合并成一条
- WORKDIR: docker 根目录
- ADD: 添加本地文件到 docker（可解压缩）
- COPY: 添加本地文件到 docker (不解压缩，COPY 优于 ADD)
- ENV: 环境常量
- VOLUME:
- EXPOSE:
  暴露的端口
- CMD:
  1. 容器启动时默认执行
  2. docker run 指定了命令 CMD 命令就被忽略
  3. 多个 CMD 只有最后一个会执行
- ENTRYPOINT:
  1. 让容器以应用程序或者服务的形式运行
  2. 不会被忽略
  3. 最佳实践：shell 脚本作为 entrypoint

## dockerhub

- 发布
  1. push
  2. 关联 github，用 dockerfile 生成镜像
- 私有 dockerhub
  1. register 镜像

## 网络

- `ping` ip 可达性，检查 ip 之间能否通信，不过可能被防火墙拦截
- `telnet`: 服务可达性，检查 ip+端口（服务）能否通信
- `ip a` 网络ip相关信息

## tips

1. `docker build` 失败时会显示失败的步骤的容器哈希值，可以通过`docker run`进入失败容器调试
2. `docker extc -it ${容器号} /bin/bash` 进入运行中的容器调试
